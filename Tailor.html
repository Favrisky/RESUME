<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RiskyResume - AI Resume Tailoring</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeIn 0.8s ease-in-out forwards; opacity: 0; }
    @keyframes fadeIn { to { opacity: 1; } }
    .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; }
    .gradient-bg { background: linear-gradient(135deg, #1f2937, #111827); }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <!-- HEADER -->
  <header class="gradient-bg shadow-xl">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-8 py-6">
      <h1 class="text-3xl font-bold text-blue-400 tracking-tight">RiskyResume</h1>
      <nav class="space-x-6 text-gray-300 font-medium">
        <a href="Index.html" class="hover:text-blue-400 transition">Home</a>
        <a href="Builder.html" class="hover:text-blue-400 transition">Builder</a>
        <a href="#templates" class="hover:text-blue-400 transition">Templates</a>
        <a href="Tailor.html" class="text-blue-400 font-semibold">Tailoring</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="text-center py-16 px-6 bg-gray-800">
    <h1 class="text-5xl md:text-6xl font-extrabold mb-6 fade-in">Tailor Your Resume <span class="text-blue-400">Like a Pro</span></h1>
    <p class="text-gray-300 text-lg md:text-xl max-w-3xl mx-auto fade-in delay-200">
      Upload your resume and job description. Our AI will craft a tailored resume and generate a personalized cover letter.
    </p>
  </section>

  <!-- UPLOAD & ACTIONS -->
  <section class="max-w-6xl mx-auto py-12 px-6 space-y-10">
    <div class="grid md:grid-cols-2 gap-8">
      <!-- Resume Upload Card -->
      <div class="bg-gray-800 rounded-3xl p-8 shadow-2xl card-hover flex flex-col items-center text-center border border-gray-700">
        <i data-feather="file-text" class="w-14 h-14 text-blue-400 mb-4"></i>
        <h2 class="text-xl font-semibold mb-3">Upload Your Resume</h2>
        <input type="file" id="resumeFile" accept=".pdf,.docx,.txt" class="hidden" onchange="handleFileUpload(event,'resume')" />
        <button onclick="document.getElementById('resumeFile').click()" class="bg-blue-500 hover:bg-blue-600 transition px-8 py-3 rounded-lg font-semibold">
          Select File
        </button>
        <p id="resumeStatus" class="text-gray-400 mt-3 text-sm"></p>
      </div>

      <!-- Job Description Upload Card -->
      <div class="bg-gray-800 rounded-3xl p-8 shadow-2xl card-hover flex flex-col items-center text-center border border-gray-700">
        <i data-feather="briefcase" class="w-14 h-14 text-green-400 mb-4"></i>
        <h2 class="text-xl font-semibold mb-3">Upload Job Description</h2>
        <input type="file" id="jobFile" accept=".pdf,.docx,.txt" class="hidden" onchange="handleFileUpload(event,'job')" />
        <button onclick="document.getElementById('jobFile').click()" class="bg-green-500 hover:bg-green-600 transition px-8 py-3 rounded-lg font-semibold">
          Select File
        </button>
        <p id="jobStatus" class="text-gray-400 mt-3 text-sm"></p>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col md:flex-row gap-6 justify-center mt-6">
      <button onclick="tailorResume()" class="flex-1 bg-blue-500 hover:bg-blue-600 py-4 rounded-2xl font-bold shadow-lg transition">‚ö° Tailor Resume</button>
      <button onclick="generateCoverLetter()" class="flex-1 bg-green-500 hover:bg-green-600 py-4 rounded-2xl font-bold shadow-lg transition">üíº Generate Cover Letter</button>
      <button onclick="downloadTailoredPDF()" class="flex-1 bg-purple-500 hover:bg-purple-600 py-4 rounded-2xl font-bold shadow-lg transition">üì• Download Tailored Resume</button>
    </div>
  </section>

    <!-- Cover Letter -->
    <div class="bg-gray-800 rounded-3xl p-8 shadow-2xl border border-green-500 fade-in">
      <h2 class="text-2xl font-semibold mb-6 flex items-center gap-3">
        <i data-feather="mail"></i> Cover Letter
      </h2>
      <div id="coverLetterOutput" class="bg-gray-700 p-6 rounded-xl min-h-[200px] whitespace-pre-wrap border border-green-400 text-gray-100">
        Your AI-generated cover letter will appear here...
      </div>
    </div>
  </section>

  <!-- SCRIPTS -->
  <script>
    feather.replace();

    let resumeText = "";
    let jobDescription = "";

    function handleFileUpload(event, type) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      const status = type === 'resume' ? document.getElementById('resumeStatus') : document.getElementById('jobStatus');

      reader.onload = (e) => {
        if (type === 'resume') resumeText = e.target.result;
        else jobDescription = e.target.result;
        status.textContent = `‚úÖ ${file.name} loaded successfully.`;
      };
      reader.readAsText(file);
    }

    async function tailorResume() {
      const output = document.getElementById('output');
      output.textContent = "‚è≥ Tailoring your resume...";

      try {
        const res = await fetch("http://localhost:3000/api/tailor-resume", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ resumeText, jobDescription })
        });
        const data = await res.json();
        output.textContent = data.tailoredResume || "‚ö†Ô∏è Error tailoring resume.";
      } catch {
        output.textContent = "‚ùå Unable to connect to backend.";
      }
    }

    async function generateCoverLetter() {
      const output = document.getElementById('coverLetterOutput');
      output.textContent = "‚úçÔ∏è Generating cover letter...";

      try {
        const res = await fetch("http://localhost:3000/api/generate-cover-letter", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ resumeText, jobDescription })
        });
        const data = await res.json();
        output.textContent = data.coverLetter || "‚ö†Ô∏è Error generating cover letter.";
      } catch {
        output.textContent = "‚ùå Unable to connect to backend.";
      }
    }

    async function downloadTailoredPDF() {
      const resumeFile = document.getElementById('resumeFile').files[0];
      if (!resumeFile) { alert("Please upload your resume first."); return; }

      const formData = new FormData();
      formData.append('resumeFile', resumeFile);
      formData.append('jobDescription', jobDescription);

      const output = document.getElementById('output');
      output.textContent = "üìÑ Generating tailored PDF...";

      try {
        const res = await fetch("http://localhost:3000/api/tailor-pdf", { method: 'POST', body: formData });
        if (!res.ok) throw new Error("PDF generation failed");

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "Tailored_Resume.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        output.textContent = "‚úÖ Tailored PDF downloaded successfully!";
      } catch (err) {
        console.error(err);
        output.textContent = "‚ùå PDF generation failed or server not reachable.";
      }
    }
  </script>
</body>
</html>
